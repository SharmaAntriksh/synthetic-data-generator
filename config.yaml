# Final output location for packaged datasets
final_output_folder: "./generated_datasets"

# ---------------------------------------------------------------------
# DEFAULTS (used unless overridden in each section)
# ---------------------------------------------------------------------
defaults:
  seed: 42

  dates:
    start: "2021-01-01"
    end: "2026-12-31"

  paths:
    geography: "./data/parquet_dims/geography.parquet"

packaging:
  reset_scratch_fact_out: true   # default current behavior
  clean_scratch_fact_out: true  # default current behavior

facts:
  enabled: ["sales", "returns"]

names:
  people_folder: "./data/name_pools/people"
  
# ---------------------------------------------------------------------
# SALES FACT GENERATION
# ---------------------------------------------------------------------
sales:
  parquet_folder: "./data/parquet_dims"
  out_folder: "./data/fact_out"

  total_rows: 500123
  chunk_size: 1000000

  file_format: "csv"          # csv | parquet | deltaparquet
  sales_output: "sales"           # sales | sales_order | both
  write_delta: true
  delta_output_folder: "./data/fact_out/delta"

  merge_parquet: true
  merged_file: "sales.parquet"
  delete_chunks: true

  row_group_size: 2000000
  compression: "snappy"

  heavy_pct: 5
  heavy_mult: 5

  workers: 8               # auto-detect if null
  write_pyarrow: true
  tune_chunk: false

  skip_order_cols: false

  override:
    dates:
      end: null
    seed: null

  partitioning:
    enabled: false
    columns: ["Year", "Month"]

returns:
  enabled: true
  return_rate: 0.01          # fraction of Sales (line) rows that get a return
  min_days_after_sale: 1     # hard cap (pipeline-level)
  max_days_after_sale: 60    # hard cap (pipeline-level)
  override:
    seed: null               # null -> use defaults.seed

# ---------------------------------------------------------------------
# PRODUCTS
# ---------------------------------------------------------------------
products:
  use_contoso_products: false
  num_products: 4100
  active_ratio: 0.94
  seed: 42

  pricing:
    base:
      value_scale: .10
      min_unit_price: 50
      max_unit_price: 5000

      # optional tuning:
      stretch_to_range: false
      stretch_low_quantile: 0.01
      stretch_high_quantile: 0.99

    cost:
      mode: margin          # add this (or "keep" if you want to preserve Contoso UnitCost when use_contoso_products: true)
      min_margin_pct: 0.30
      max_margin_pct: 0.65

    jitter:
      price_pct: 0.03
      cost_pct: 0.02

    brand_normalization:
      enabled: true
      brand_col: Brand          # or BrandName; if omitted we'll try Brand then BrandName
      alpha: 0.70               # 0..1 (strength of pull toward global typical price)
      min_factor: 0.60          # clamp per-brand rescale factor
      max_factor: 1.60
      min_count: 10             # brands with < min_count products won't be adjusted
      noise_sd: 0.05            # optional per-brand log-noise (0 disables)
    # NEW: controls how prices *look* (works for max 2000 / 10000 / etc.)
    appearance:
      snap_unit_price: true
      price_ending: 0.99
      price_bands:
        - {max: 100,   step: 1}
        - {max: 1000,  step: 10}
        - {max: 10000, step: 50}
        - {max: 1e18,  step: 100}

      round_unit_cost: true
      cost_bands:
        - {max: 100,   step: 0.05}
        - {max: 1000,  step: 0.10}
        - {max: 10000, step: 1}
        - {max: 1e18,  step: 5}

# ---------------------------------------------------------------------
# CUSTOMERS
# ---------------------------------------------------------------------
customers:
  total_customers: 18433
  active_ratio: 0.90

  pct_india: 10
  pct_us: 51
  pct_eu: 39
  pct_org: 10

  names_folder: "./data/customer_names"

  lifecycle:
    enable_churn: true
    base_monthly_churn: 0.52
    min_tenure_months: 22
    initial_active_customers: 2000        # or 1000
    initial_spread_months: 36            # customers started in the 24 months before start_date

  override:
    seed: null
    paths: {}
    dates: {}
    
# ---------------------------------------------------------------------
# CUSTOMER SEGMENTS
# ---------------------------------------------------------------------
customer_segments:
  enabled: true

  segment_count: 12
  segments_per_customer_min: 1
  segments_per_customer_max: 4

  include_score: true
  include_primary_flag: true
  include_validity: true

  validity:
    grain: month          # recommend month for size/perf
    churn_rate_qtr: 0.08  # % customers whose membership changes per quarter
    new_customer_months: 2

  seed: 123

# ---------------------------------------------------------------------
# SUPERPOWERS (Customers <-> Superpowers)
# ---------------------------------------------------------------------
superpowers:
  enabled: true

  powers_count: 40              # <= catalog size in the script
  powers_per_customer_min: 1
  powers_per_customer_max: 4

  include_power_level: true
  include_primary_flag: true
  include_acquired_date: true
  include_validity: false

  seed: 123

# ---------------------------------------------------------------------
# GEOGRAPHY / LOCATIONS
# ---------------------------------------------------------------------
geography:
  target_rows: 200

  country_weights:
    United States: 0.35
    India: 0.20
    United Kingdom: 0.10
    Germany: 0.10
    France: 0.10
    Australia: 0.07
    Canada: 0.08
    China: 0.00
    Japan: 0.00
    South Africa: 0.00
    Rest: 0.00

  override:
    dates: {}
    paths: {}
    seed: null


# ---------------------------------------------------------------------
# PROMOTIONS
# ---------------------------------------------------------------------
promotions:
  num_seasonal: 21
  num_clearance: 8
  num_limited: 12

  override:
    dates:
      start: null      # null means: use defaults
      end: null
    seed: null


# ---------------------------------------------------------------------
# STORES / RETAIL OUTLETS
# ---------------------------------------------------------------------
stores:
  num_stores: 20
  ensure_currency_coverage: true
  opening:
    start: "1995-01-01"
    end: "2020-12-31"

  closing_end: "2025-12-31"

  employee_count:
    mode: by_type          # by_type | scaled_sqft
    open_by_type:
      Convenience: [4, 10]
      Supermarket: [8, 16]
      Hypermarket: [12, 24]
      Online: [3, 8]
    renovating_range: [0, 3]
    closed_range: [0, 0]
    clamp_min: 0
    clamp_max: 40

  override:
    seed: null
    paths: {}

# ---------------------------------------------------------------------
# EMPLOYEES (Dimension)
# ---------------------------------------------------------------------
employees:
  # sizing (demo-friendly defaults)
  use_store_employee_count: false
  min_staff_per_store: 2
  max_staff_per_store: 6
  staff_scale: 0.25         # only used if use_store_employee_count: true

  # schema choice
  include_store_cols: false # if you want DimEmployee NOT to include StoreKey/GeographyKey

  # HR enrichment
  hr:
    email_domain: "contoso.com"
    
  store_assignments:
    enabled: true

    mover_share: 0.10
    pool_scope: district
    allow_store_revisit: true
    part_time_multiplier: 1.5

    primary_sales_role: "Sales Associate"

    max_non_sales_multiplier_frac: 0.35
    max_non_sales_episodes_frac: 0.50

    secondary_fte_min: 0.10
    secondary_fte_max: 0.40

    role_profiles:
      default:
        role_multiplier: 0.20
        episodes_min: 0
        episodes_max: 1
        duration_days_min: 60
        duration_days_max: 180

      Sales Associate:
        role_multiplier: 2.50
        episodes_min: 1
        episodes_max: 4
        duration_days_min: 60
        duration_days_max: 240

      Cashier:
        role_multiplier: 1.10
        episodes_min: 1
        episodes_max: 3
        duration_days_min: 14
        duration_days_max: 120

      Fulfillment Associate:
        role_multiplier: 0.15
        episodes_min: 0
        episodes_max: 1
        duration_days_min: 90
        duration_days_max: 240
# ---------------------------------------------------------------------
# DATES (Dimension)
# ---------------------------------------------------------------------
dates:
  fiscal_month_offset: 5
  as_of_date: "2026-12-31"  # anchor for IsToday/IsCurrent* and CurrentDayOffset
                            # Treat end of dataset as “today” (default): omit it (it uses raw_end). 
                            # Anchor to last year end: as_of_date: "2025-12-31"
  include:
    calendar: true        # always true (safe default)
    iso: false            # ISO week columns
    fiscal: false         # fiscal year / quarter / month columns

  override:
    dates:
      start: null     # optional, null = use defaults
      end:   null     # optional, null = use defaults


# ---------------------------------------------------------------------
# EXCHANGE RATES
# ---------------------------------------------------------------------
exchange_rates:
  use_global_dates: true

  # Master FX history storage
  master_file: "./data/exchange_rates_master/fx_master.parquet"

  currencies: ["USD", "EUR", "INR", "GBP", "AUD", "CAD"]
  base_currency: "USD"
  volatility: 0.02

# Used only when use_global_dates = false
  override:
    dates:
      start: "2009-01-01"
      end: "2025-11-18"        # optional (ignored if use_global_dates=true)
    seed: null
