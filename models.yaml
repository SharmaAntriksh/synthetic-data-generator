# ============================================================
# HIGH-LEVEL TUNING (preferred)
# Edit ONLY these 3 knobs. config_loader.apply_acquisition_tuning()
# will derive detailed customer discovery + participation settings.
# ============================================================
tuning:
  acquisition_intensity: 0.55      # 0..1 (higher => more new customers)
  acquisition_smoothness: 0.90     # 0..1 (higher => flatter spread)
  acquisition_cycles: 0.2         # 0..1 (higher => bigger multi-year waves)

models:

  # ============================================================
  # ACTIVITY / TRANSACTION THINNING
  # Controls WHEN orders occur and how dense each month is
  # ============================================================
  activity:
    size_scale_threshold: 200000

    # Keep false for realistic variability in month-by-month generation.
    preserve_row_count: true  # allow thinning to reduce month volume; set true only if you MUST hit an exact row total.

    # Higher = smoother month-to-month continuity
    month_inertia: 0.73

    # Monthly transaction intensity pattern (retail: Nov/Dec peak, Feb dip)
    monthly_baseline:
      - 0.92  # Jan
      - 0.86  # Feb
      - 0.96  # Mar
      - 1.00  # Apr
      - 1.03  # May
      - 1.05  # Jun
      - 1.04  # Jul
      - 1.02  # Aug
      - 0.99  # Sep
      - 1.06  # Oct
      - 1.18  # Nov
      - 1.16  # Dec

    volatility:
      # Higher => more spiky months (use 0.06–0.10)
      sigma: 0.006

    row_noise:
      # Small dataset: keep lower noise so early months don’t collapse
      sigma_small_dataset: 0.10
      sigma_large_dataset: 0.30

    bounds:
      dataset_split_threshold: 300000

      # Tight bounds for smaller datasets to avoid extremes
      small_dataset:
        low: 0.82
        high: 1.22

      # Larger datasets tolerate more natural variance
      large_dataset:
        low: 0.82
        high: 1.18


  # ============================================================
  # BASE DEMAND NORMALIZATION (macro volume shape)
  # Drives overall row allocation per month BEFORE customer sampling
  # ============================================================
  macro_demand:
    base_level: 1.0

    # Mild long-run growth (keep low if you want stable totals across years)
    yearly_growth: 0.08

    # Additional smooth seasonality (use alongside activity.monthly_baseline)
    seasonality_amplitude: 0.16
    seasonality_phase: 0.0

    # Small random drift month-to-month
    noise_std: 0.10

    # Rare demand shocks to create “decline then recovery” windows
    shock_probability: 0.22
    shock_impact: [-0.40, 0.30]   # multiplicative hit range

    # Prevent early months from concentrating too many rows on too few customers
    early_month_cap:
      enabled: true
      max_rows_per_customer: 12
      redistribute_excess: true

  # ============================================================
  # CUSTOMER PARTICIPATION (distinct customers per month)
  # This is the knob set that creates multi-year "incline/decline" in #customers.
  # (Requires chunk_builder logic to use it; safe to keep even if unused.)
  # ============================================================
  customer_participation:
    # target distinct customers ≈ base_distinct_ratio * eligible_customers (then modulated by cycles)
    base_distinct_ratio: 0.30

    # hard floors/caps (prevents “month has 1 customer” and “everyone buys every month”)
    min_distinct_customers: 200
    max_distinct_ratio: 0.65

    # multi-year waves: incline -> decline -> incline ...
    cycles:
      enabled: true
      period_months: 24       # 2-year waves
      amplitude: 0.30         # +/-35% swing
      phase: 0.0
      noise_std: 0.05         # irregularity around the wave


  # ============================================================
  # QUANTITY / BASKET SIZE
  # Controls HOW MANY units per order line
  # ============================================================
  quantity:
    base_poisson_lambda: 3.2
    month_inertia: 0.82

    # Retail: slightly larger baskets in Nov/Dec
    monthly_factors:
      - 0.99
      - 0.98
      - 1.00
      - 1.00
      - 1.01
      - 1.02
      - 1.02
      - 1.01
      - 1.00
      - 1.03
      - 1.06
      - 1.05

    noise_sd: 0.12
    min_qty: 1
    max_qty: 6


  # ============================================================
  # CUSTOMER LIFECYCLE (macro pool evolution)
  # Controls WHICH customers are active over time
  # (Keep conservative; customer start distribution + warm-start handles early base.)
  # ============================================================
  customers:
    base_active_rate: 0.78
    annual_growth_rate: 0.08
    annual_churn_rate: 0.18
    monthly_noise: 0.04

    # Optional waves in active pool (separate from participation waves)
    seasonal_growth_amplitude: 0.12
    seasonal_period_months: 24

    # Safety floor (used only if your lifecycle model enforces it)
    min_monthly_new_customers: 40
    even_start_months: false

  # ============================================================
  # CUSTOMER DISCOVERY (first-time appearance)
  # Controls how quickly undiscovered-but-eligible customers get their first order.
  # ============================================================
  customer_discovery:
    # Rate knobs (keep mild; they should not dominate if you're using target_new)
    base_discovery_rate: 0.08
    min_discovery_rate: 0.05
    max_discovery_rate: 0.20
    seasonal_amplitude: 0.40
    seasonal_period_months: 24

    # Shape knobs (these are the important ones)
    max_fraction_per_month: 0.01
    orders_per_new_customer: 30

    min_new_customers_per_month: 60
    min_new_customers_steady: 120
    floor_ramp_months: 48
    bootstrap_suppression_months: 3
  # ============================================================
  # PRICING PIPELINE
  # Controls HOW MUCH revenue is generated per unit (inflation + discounts)
  # ============================================================
  pricing:
    month_inertia: 0.65     # was 0.78 (prices react faster, more variation)

    ramp:
      months: 18
      min_multiplier: 0.95
      max_multiplier: 1.35
      discount_scale: 0.60
      discount_noise_sigma: 0.18

    inflation:
      annual_rate: 0.18
      noise_sigma: 0.02

    seasonality:
      enabled: true
      amplitude: 0.06
      sharpness: 1.2
      phase_shift_months: -1

    discount:
      max_pct_of_price: 0.40

    floors:
      min_net_price: 0.01

    cost:
      cost_ratio_min: 0.62
      cost_ratio_max: 0.84
      min_margin_pct: 0.06

