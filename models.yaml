# ============================================================
# HIGH-LEVEL TUNING (preferred)
# config_loader.apply_acquisition_tuning() can use these
# ============================================================
tuning:
  acquisition_intensity: 0.55      # 0..1 (higher => more new customers)
  acquisition_smoothness: 0.90     # 0..1 (higher => flatter spread)
  acquisition_cycles: 0.35         # 0..1 (higher => bigger multi-year waves)

models:

  # ============================================================
  # ACTIVITY / TRANSACTION THINNING
  # Shapes month-to-month order density (keeps rowcount if preserve_row_count=true)
  # ============================================================
  activity:
    enabled: true
    size_scale_threshold: 200000

    # Keep TRUE if you must hit an exact row total (recommended for your pipeline)
    preserve_row_count: true

    # Higher = smoother month-to-month continuity
    month_inertia: 0.73

    # Retail-like year seasonality (12 values)
    monthly_baseline:
      - 0.92  # Jan
      - 0.86  # Feb
      - 0.96  # Mar
      - 1.00  # Apr
      - 1.03  # May
      - 1.05  # Jun
      - 1.04  # Jul
      - 1.02  # Aug
      - 0.99  # Sep
      - 1.06  # Oct
      - 1.18  # Nov
      - 1.16  # Dec

    volatility:
      # Higher => spikier months (try 0.02–0.08)
      sigma: 0.01

    row_noise:
      # Adds within-month variability; keep smaller for small datasets
      sigma_small_dataset: 0.10
      sigma_large_dataset: 0.30

    bounds:
      dataset_split_threshold: 300000
      small_dataset: { low: 0.82, high: 1.22 }
      large_dataset: { low: 0.82, high: 1.18 }

  # ============================================================
  # MACRO DEMAND (row allocation shape per month)
  # ============================================================
  macro_demand:
    base_level: 1.0
    yearly_growth: 0.03            # keep low for stable yearly totals
    seasonality_amplitude: 0.08
    seasonality_phase: 0.0
    noise_std: 0.06

    # Rare demand shocks to create “decline then recovery” windows
    shock_probability: 0.10
    shock_impact: [-0.25, 0.20]    # multiplicative range

    # Prevent early months from concentrating too many rows on too few customers
    early_month_cap:
      enabled: true
      max_rows_per_customer: 12
      redistribute_excess: true

  # ============================================================
  # DISTINCT CUSTOMER PARTICIPATION (per month)
  # This is the main knob for “some years down, next year up”
  # ============================================================
  customer_participation:
    base_distinct_ratio: 0.35
    min_distinct_customers: 250
    max_distinct_ratio: 0.70

    cycles:
      enabled: true
      period_months: 36     # 3-year waves (24 = 2-year; 48 = 4-year)
      amplitude: 0.35       # +/- swing in distinct customers
      phase: 0.0
      noise_std: 0.06

  # ============================================================
  # QUANTITY / BASKET SIZE
  # ============================================================
  quantity:
    base_poisson_lambda: 3.2
    month_inertia: 0.82

    monthly_factors:
      - 0.99
      - 0.98
      - 1.00
      - 1.00
      - 1.01
      - 1.02
      - 1.02
      - 1.01
      - 1.00
      - 1.03
      - 1.06
      - 1.05

    noise_sd: 0.12
    min_qty: 1
    max_qty: 6

  # ============================================================
  # CUSTOMER DISCOVERY (first-time appearance)
  # ============================================================
  customer_discovery:
    base_discovery_rate: 0.08
    min_discovery_rate: 0.05
    max_discovery_rate: 0.20
    seasonal_amplitude: 0.30
    seasonal_period_months: 24

    # discovery shape
    max_fraction_per_month: 0.015
    orders_per_new_customer: 30

    # floors (prevents “month has 1 new customer”)
    min_new_customers_per_month: 80
    min_new_customers_steady: 160
    floor_ramp_months: 60
    bootstrap_suppression_months: 6

  # ============================================================
  # OPTIONAL: Customer activity overlay (usually keep OFF)
  # Uses CustomerStartMonth/EndMonth as base, then adds dormancy/reactivation.
  # ============================================================
  customer_activity_overlay:
    enabled: false
    base_monthly_activity_rate: 0.85
    month_inertia: 0.75
    monthly_reactivation_rate: 0.08
    seasonal_amplitude: 0.10
    seasonal_period_months: 12
    per_customer_sigma: 0.20
    seed: 1234

  # ============================================================
  # SALES-TIME PRICE DRIFT (uses Product UnitPrice/UnitCost as base)
  # Promotions do NOT affect pricing here (analysis-time only via PromotionKey).
  # ============================================================
  pricing:
    # Smooth month-to-month factor changes (0 = independent months; 0.8+ = smoother)
    month_inertia: 0.85

    # Keep DiscountAmount “clean” (computed in compute_prices and quantized there)
    # If your pricing pipeline scales prices by time factor, set this false unless
    # your pipeline re-quantizes discounts after scaling.
    apply_base_factor_to_discount: false

    inflation:
      annual_rate: 0.06
      noise_sigma: 0.00

    seasonality:
      enabled: true
      amplitude: 0.03
      sharpness: 1.2
      phase_shift_months: -1

    # Disable ramp by default (keeps it simple)
    ramp:
      months: 0
      min_multiplier: 1.0
      max_multiplier: 1.0
      discount_scale: 1.0
      discount_noise_sigma: 0.0

    # Safety bounds
    discount:
      max_pct_of_price: 0.50

    floors:
      min_net_price: 0.01

    # Markdown model (Sales.DiscountAmount), independent from Promotions
    markdown:
      enabled: true
      max_pct_of_price: 0.50
      min_net_price: 0.01
      allow_negative_margin: false

      ladder:
        - { kind: none, value: 0.0,  weight: 0.55 }
        - { kind: pct,  value: 0.05, weight: 0.18 }
        - { kind: pct,  value: 0.10, weight: 0.12 }
        - { kind: pct,  value: 0.15, weight: 0.08 }
        - { kind: amt,  value: 25.0, weight: 0.04 }
        - { kind: amt,  value: 50.0, weight: 0.03 }

      appearance:
        quantize_discount: true
        discount_rounding: floor   # floor | nearest
        discount_bands:
          - { max: 50,    step: 0.50 }
          - { max: 200,   step: 1 }
          - { max: 1000,  step: 5 }
          - { max: 5000,  step: 10 }
          - { max: 1e18,  step: 25 }
